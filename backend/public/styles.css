/* Theme system with light/dark modes */
html { color-scheme: light dark; }

/* Light theme */
html[data-theme="light"] {
  --bg:#e6f0e6;
  --surface:#ffffff;
  --text:#1f2937;
  --muted:#4b5563;
  --primary:#1e6d27;
  --primary-600:#155a1e;
  --primary-700:#155a1e;
  --accent:#f4b400;
  --accent-600:#cc9600;
  --accent-700:#cc9600;
  --border:#d1d5db;
  --shadow:0 14px 40px rgba(17,54,22,.18);
  --chip-bg: #ffeab6;
  --chip-text: #5b4c0a;
  --input-bg: #f7faf7;
  --success: #22c55e;
  --danger: #ef4444;
}

/* Dark theme */
html[data-theme="dark"] {
  --bg:#0f1a14;
  --surface:#13251c;
  --text:#e8f4ec;
  --muted:#a7bdb2;
  --primary:#57c07a;
  --primary-600:#3aa661;
  --primary-700:#3aa661;
  --accent:#e6b945;
  --accent-600:#cb9e2b;
  --accent-700:#cb9e2b;
  --border:#264433;
  --shadow:0 14px 40px rgba(0,0,0,.35);
  --chip-bg: #2a4435;
  --chip-text: #d4e8dc;
  --input-bg: #0f1f18;
  --success: #22c55e;
  --danger: #ef4444;
}

/* Base */
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; overflow: hidden; }
body{
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  color: var(--text);
  background: var(--bg);
  transition: background-color .3s ease, color .3s ease;
  padding: 0;
  height: 100vh;
  font-size: 15px;
}

.container {
  position: relative;
  max-width: 1800px;
  margin: 0 auto;
  padding: 24px;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Site header with title, tagline, and theme toggle */
.app-title {
  font-size: clamp(42px, 5vw, 64px);
  font-weight: 800;
  background: linear-gradient(135deg, #1e6d27 0%, #2d9940 50%, #1e6d27 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin: 0 0 24px 0;
  letter-spacing: -1.5px;
  text-align: center;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, system-ui, sans-serif;
  text-shadow: 0 2px 8px rgba(30, 109, 39, 0.15);
  position: relative;
  filter: drop-shadow(0 2px 4px rgba(30, 109, 39, 0.1));
  flex-shrink: 0;
}

.app-title::after {
  content: 'ðŸŒ¿';
  position: absolute;
  font-size: 0.6em;
  margin-left: 8px;
  filter: none;
  -webkit-text-fill-color: initial;
}

/* Fixed theme toggle button in bottom right corner */
.theme-toggle-fixed {
  position: fixed;
  bottom: 32px;
  right: 32px;
  background: var(--primary);
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  transition: transform .2s ease, box-shadow .2s ease, background-color .3s ease;
  font-size: 24px;
  z-index: 1000;
}
.theme-toggle-fixed:hover { 
  transform: scale(1.1) rotate(10deg); 
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
}
.theme-toggle-fixed:active { 
  transform: scale(0.95); 
}

html[data-theme="dark"] .theme-toggle-fixed {
  background: var(--primary);
}

/* Footer */
/* Footer (not used) removed for performance */

/* Main layout grid: left column (Chat 50%), right column (Products + Shopping 50%) */
.main-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

@media (max-width: 1023px) {
  .main-grid { grid-template-columns: 1fr; gap: 16px; }
}

/* Cards */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 20px;
  box-shadow: var(--shadow);
  transition: background-color .3s ease, border-color .3s ease;
}
.card + .card { margin-top: 0; }
.section-header { 
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-shrink: 0;
}
.section-header h2 { margin: 0; font-weight: 600; font-size: 24px; color: var(--primary); letter-spacing: -0.3px; }
.section-title { margin: 0 0 12px; font-weight: 600; font-size: 24px; color: var(--primary); letter-spacing: -0.3px; flex-shrink: 0; }
.card-tall { height: 100%; display: flex; flex-direction: column; overflow: hidden; }
.products-card, .shopping-card { min-height: 0; flex: 1; display: flex; flex-direction: column; overflow: hidden; }
.card-tall .list-area { flex: 1 1 auto; overflow: auto; min-height: 0; }

/* Right sidebar stacks Products and Shopping with 50/50 split */
.sidebar-stack {
  display: flex;
  flex-direction: column;
  gap: 20px;
  height: 100%;
  min-height: 0;
  overflow: hidden;
}

/* Remove old left column flex styles */



h2.section {
  font-size: 22px;
  font-weight: 600;
  margin: 0 0 14px 0;
  color: var(--primary);
  letter-spacing: -0.3px;
}

small.subtle { color: var(--muted); }

/* Removed unused shimmer spinner */

/* Animated produce background with 3 parallax layers */
.bg-produce {
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  overflow: hidden;
}
.bg-produce .produce {
  position: absolute;
  width: 64px; height: 64px;
  fill: #5fae59;
  opacity: .30;
  stroke: #154f1b;
  stroke-width: 1.2;
  stroke-opacity: .28;
  filter: drop-shadow(0 3px 9px rgba(21,79,27,.18));
}

/* Parallax layers with different speeds and opacities */
.bg-produce .layer1 .produce {
  animation: float 26s linear infinite;
  opacity: .30;
}
.bg-produce .layer2 .produce {
  animation: float 20s linear infinite;
  opacity: .24;
}
.bg-produce .layer3 .produce {
  animation: float 16s linear infinite;
  opacity: .18;
}

@keyframes float {
  0%   { transform: translateY(0) translateX(0) rotate(0deg); }
  50%  { transform: translateY(-40px) translateX(28px) rotate(6deg); }
  100% { transform: translateY(0) translateX(0) rotate(0deg); }
}

/* size variants */
.p-md { width: 120px; height: 120px; }
.p-lg { width: 180px; height: 180px; }
.p-xl { width: 240px; height: 240px; }

/* Specific icon color tweaks to complement theme */
.produce.banana { fill:#e8b84c; }
.produce.cheese { fill:#f2c84e; }
.produce.oil { fill:#a3c46b; }
.produce.apple { fill:#d95353; }
.produce.carrot { fill:#e87a37; }
.produce.lettuce { fill:#7bc971; }
.produce.strawberry { fill:#e63946; }
.produce.pepper { fill:#52b788; }
.produce.corn { fill:#f4c430; }
.produce.orange { fill:#ff9f1c; }
.produce.mushroom { fill:#c9ada7; }

/* Dark mode adjustments for background */
html[data-theme="dark"] .bg-gradient {
  background:
    radial-gradient(circle at 30% 40%, rgba(87, 192, 122, 0.12) 0%, transparent 50%),
    radial-gradient(circle at 70% 60%, rgba(46, 125, 50, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 50% 90%, rgba(102, 187, 106, 0.08) 0%, transparent 50%),
    linear-gradient(135deg, #0c1f18 0%, #13251c 25%, #0f2a22 50%, #10271f 75%, #0c1f18 100%);
  background-size: 400% 400%, 400% 400%, 400% 400%, 400% 400%;
  animation: 
    gradientShiftDark 18s ease infinite,
    gradientMoveDark 22s ease-in-out infinite,
    pulseDark 10s ease-in-out infinite;
}

@keyframes gradientShiftDark {
  0%, 100% { 
    background-position: 0% 50%, 100% 50%, 50% 100%, 0% 50%; 
  }
  25% { 
    background-position: 100% 50%, 0% 100%, 100% 0%, 50% 100%; 
  }
  50% { 
    background-position: 50% 100%, 50% 0%, 0% 50%, 100% 50%; 
  }
  75% { 
    background-position: 0% 0%, 100% 100%, 100% 50%, 50% 0%; 
  }
}

@keyframes gradientMoveDark {
  0%, 100% { 
    filter: brightness(0.95) saturate(1.2) contrast(1.08);
  }
  33% { 
    filter: brightness(1) saturate(1.25) contrast(1.1);
  }
  66% { 
    filter: brightness(0.98) saturate(1.15) contrast(1.06);
  }
}

@keyframes pulseDark {
  0%, 100% { 
    opacity: 1;
  }
  50% { 
    opacity: 0.92;
  }
}

html[data-theme="dark"] .bg-produce .produce {
  fill: #7ed09a;
  opacity: .28;
  stroke: #c7f1d2;
  stroke-opacity: .35;
}
html[data-theme="dark"] .app-title {
  background: linear-gradient(135deg, #57c07a 0%, #7ed09a 50%, #57c07a 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  filter: drop-shadow(0 2px 6px rgba(87, 192, 122, 0.15));
}

/* Inputs */
.input-wrap { position: relative; }
.input-icon {
  position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
  width: 18px; height: 18px; color: var(--muted);
}
.input {
  width: 100%;
  height: 44px;
  padding: 12px 14px 12px 38px;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: var(--input-bg);
  color: var(--text);
  font-size: 17px;
  font-weight: 400;
  outline: none;
  transition: box-shadow .15s ease, border-color .15s ease, background-color .3s ease;
}
.input::placeholder { color: var(--muted); opacity: 0.7; font-weight: 400; }
.input:focus {
  border-color: var(--accent);
  outline: 2px solid var(--accent);
  outline-offset: 2px;
  box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 30%, transparent);
}

textarea.input {
  border-radius: 14px;
  padding-left: 14px;
  resize: vertical;
  line-height: 1.5;
  font-size: 17px;
}

/* Buttons */
.btn {
  display: inline-flex; align-items: center; justify-content: center;
  gap: 8px;
  border: 1px solid transparent;
  border-radius: 12px;
  height: 40px;
  padding: 10px 16px;
  font-weight: 600;
  font-size: 16px;
  letter-spacing: 0.2px;
  cursor: pointer;
  transition: transform .12s ease, filter .12s ease, background-color .15s ease, border-color .15s ease, color .15s ease;
}
.btn:disabled { opacity: .6; cursor: not-allowed; filter: grayscale(.2); }
.btn:hover { transform: translateY(-1px); filter: brightness(1.03); }
.btn:active { transform: translateY(1px); }

.btn-primary { background: var(--primary); color: #fff; }
.btn-primary:hover { background: var(--primary-600); }

.btn-accent { background: var(--accent); color: #222; font-weight: 600; }
.btn-accent:hover { background: var(--accent-600); }

.btn-ghost { background: var(--input-bg); color: var(--text); border-color: var(--border); font-weight: 500; }
.btn-ghost:hover { background: color-mix(in srgb, var(--border) 30%, var(--input-bg)); }

.btn-danger-outline { background: transparent; color: var(--danger); border-color: color-mix(in srgb, var(--danger) 30%, var(--border)); font-weight: 500; }
.btn-danger-outline:hover { background: color-mix(in srgb, var(--danger) 10%, transparent); }

.btn-small { padding: 6px 12px; border-radius: 999px; font-size: 14px; height: auto; font-weight: 600; }

.btn-qty {
  width: 28px;
  height: 28px;
  padding: 0;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text);
  font-size: 16px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Tables */
.table { width: 100%; border-collapse: collapse; }
.table th, .table td { padding: 12px 10px; font-size: 16px; border-bottom: 1px solid var(--border); }
.table thead th { color: var(--muted); font-weight: 600; font-size: 15px; text-transform: uppercase; letter-spacing: 0.5px; }
.table tbody td { font-size: 16.5px; }
.table tbody tr:nth-child(even) { background: color-mix(in oklab, var(--primary) 6%, transparent); }
.table tbody tr:hover { background: color-mix(in oklab, var(--primary) 12%, transparent); }
.table tbody tr.is-selected { background: color-mix(in oklab, var(--primary) 18%, transparent); }
.price-col { text-align: right; font-weight: 600; font-variant-numeric: tabular-nums; }
.add-col { width: 60px; text-align: center; padding: 8px 4px !important; }

.scroll-area, .scroll { 
  flex: 1;
  overflow: auto;
  min-height: 0;
}

/* Chat */
.chat-list { 
  display: flex; 
  flex-direction: column; 
  gap: 10px; 
  overflow-y: auto; 
  padding: 6px 0; 
  flex: 1;
  min-height: 0;
}
.chat-bubble { max-width: 80%; padding: 14px 18px; border-radius: 18px; font-size: 17px; line-height: 1.6; box-shadow: 0 2px 8px rgba(46,125,50,.08); }
.chat-bot { background: color-mix(in oklab, var(--primary) 8%, var(--surface)); color: var(--text); border-top-left-radius: 4px; }
.chat-user { background: var(--primary); color: #fff; margin-left: auto; border-bottom-right-radius: 4px; font-weight: 500; }

/* Typing indicator bubble */
.typing-bubble { opacity: 0.9; }
.typing-indicator { display: inline-flex; align-items: center; gap: 6px; min-width: 36px; }
.typing-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--muted); opacity: .5; animation: typingBlink 1.2s infinite ease-in-out; }
.typing-dot:nth-child(2) { animation-delay: .2s; }
.typing-dot:nth-child(3) { animation-delay: .4s; }
@keyframes typingBlink {
  0%, 80%, 100% { transform: translateY(0); opacity: .35; }
  40% { transform: translateY(-3px); opacity: 1; }
}

.recipe { margin-top: 12px; padding: 12px; border: 1px dashed var(--border); border-radius: 12px; background: var(--surface); }
.recipe small { color: var(--primary); font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
.recipe strong { font-weight: 600; font-size: 17px; }
.recipe ul, .recipe ol { font-size: 16px; line-height: 1.6; }
.recipe li { margin-bottom: 6px; }

/* Make chat card fill full height of left column */
.chat-card {
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-height: 0;
}

/* Typing indicator */
.typing {
  margin-top: 8px;
  font-size: 14px;
  color: var(--muted);
  font-style: italic;
}
.hidden { display: none; }

/* Shopping List with improved chips */
.shopping-list-title { font-size: 24px; font-weight: 600; color: var(--primary); margin-bottom: 16px; letter-spacing: -0.3px; }
.shopping-row { 
  display: flex; 
  align-items: center;
  justify-content: space-between; 
  padding: 14px 0;
  border-bottom: 1px solid var(--border);
  font-size: 17px;
}
.shopping-row:last-child { border-bottom: none; }

.chip {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  width: 100%;
}
.chip .meta {
  display: flex;
  flex-direction: column;
  min-width: 0;
  flex: 1;
}
.chip .name {
  font-weight: 500;
  font-size: 17px;
  letter-spacing: -0.1px;
  color: var(--text);
}
.chip .sub {
  font-size: 15px;
  color: var(--muted);
  margin-top: 4px;
  font-weight: 400;
}
.chip .qty {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.chip-actions {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: 12px;
}

.sl-footer {
  margin-top: 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  flex-wrap: wrap;
  padding-top: 12px;
  border-top: 1px solid var(--border);
}
.controls-row {
  display: flex;
  gap: 8px;
}

/* Custom scrollbar */
.scroll-area, .chat-list, .scroll {
  scrollbar-width: thin;
  scrollbar-color: color-mix(in oklab, var(--primary) 35%, transparent) transparent;
}
.scroll-area::-webkit-scrollbar, .chat-list::-webkit-scrollbar, .scroll::-webkit-scrollbar { 
  width: 8px; 
  height: 8px; 
}
.scroll-area::-webkit-scrollbar-thumb, .chat-list::-webkit-scrollbar-thumb, .scroll::-webkit-scrollbar-thumb { 
  background: color-mix(in oklab, var(--primary) 35%, transparent); 
  border-radius: 999px; 
}
.scroll-area::-webkit-scrollbar-track, .chat-list::-webkit-scrollbar-track, .scroll::-webkit-scrollbar-track { 
  background: transparent; 
}

/* Focus ring */
:focus-visible, .input:focus, .btn:focus, .chip:focus { 
  outline: 2px solid var(--accent); 
  outline-offset: 2px; 
}

/* Footer note */
.footer-note { 
  margin: 0;
  padding: 8px 0 0 0; 
  text-align: center; 
  color: var(--primary); 
  font-size: 12px;
  flex-shrink: 0;
}

/* Layout adjustments */
.app-shell {
  position: relative;
  z-index: 2;
  background: var(--surface);
  border-radius: 24px;
  border: 1px solid var(--border);
  padding: 24px;
  box-shadow: var(--shadow);
  transition: background-color .3s ease, border-color .3s ease;
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-height: 0;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .bg-gradient { animation: none !important; }
  .bg-produce .produce { animation: none !important; transform: none !important; }
  .btn { transition: none !important; }
}

/* Animated green background that stays under the icons */
.bg-gradient {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
  /* Multi-layer gradient with wave-like color transitions */
  background:
    radial-gradient(circle at 20% 50%, rgba(46, 125, 50, 0.22) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(56, 142, 60, 0.18) 0%, transparent 50%),
    radial-gradient(circle at 40% 80%, rgba(102, 187, 106, 0.15) 0%, transparent 50%),
    linear-gradient(135deg, #d4ead4 0%, #c5e3c5 25%, #cfe8cf 50%, #bcdcbc 75%, #d4ead4 100%);
  background-size: 400% 400%, 400% 400%, 400% 400%, 400% 400%;
  animation: 
    gradientShift 15s ease infinite,
    gradientMove 20s ease-in-out infinite,
    pulse 8s ease-in-out infinite;
  will-change: background;
}

/* Removed unused keyframes: waveMove */

@keyframes gradientShift {
  0%, 100% { 
    background-position: 0% 50%, 100% 50%, 50% 100%, 0% 50%; 
  }
  25% { 
    background-position: 100% 50%, 0% 100%, 100% 0%, 50% 100%; 
  }
  50% { 
    background-position: 50% 100%, 50% 0%, 0% 50%, 100% 50%; 
  }
  75% { 
    background-position: 0% 0%, 100% 100%, 100% 50%, 50% 0%; 
  }
}

@keyframes gradientMove {
  0%, 100% { 
    filter: brightness(1.02) saturate(1.1) contrast(1.05);
  }
  33% { 
    filter: brightness(1.05) saturate(1.15) contrast(1.08);
  }
  66% { 
    filter: brightness(1.03) saturate(1.08) contrast(1.06);
  }
}

@keyframes pulse {
  0%, 100% { 
    opacity: 1;
  }
  50% { 
    opacity: 0.95;
  }
}

/* Duplicate icon styling removed (defined earlier) */

/* Removed unused custom property and keyframes: --hue, hueShift, drift */

/* Duplicate reduced-motion block removed (handled above) */

/* Ensure app content sits above both layers */
.app-shell, .pane, .container, main { position: relative; z-index: 2; }

/* Toast */
#toast-container { position: fixed; right: 16px; bottom: 16px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
.toast {
  background: var(--surface);
  color: var(--text);
  border: 1px solid var(--border);
  padding: 12px 16px;
  border-radius: 10px;
  box-shadow: var(--shadow);
  font-size: 14px;
  opacity: 0; transform: translateY(8px);
  animation: toastIn .2s ease forwards;
}
@keyframes toastIn { to { opacity: 1; transform: translateY(0); } }